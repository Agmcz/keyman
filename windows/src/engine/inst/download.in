
# Copy files to correct names in \release; this file is munged by mkver to download.mak
#

!include ..\..\defines.mak

# It would be good to have a single merge module for CEF but it's not critical
# as we will end up using the CEF from Keyman Engine in Keyman Developer

# We use different directories so that heat generates
# different identifiers for the various folders
KEYMAN_WIX_TEMP_CEF=$(TEMP)\keyman_wix_build\cef

default:
  echo Please don't call this file directly -- used by Makefile

copyredist:
  -mkdir $(ROOT)\release\$VERSION
  copy /Y $(ROOT)\src\engine\inst\keymanengine.msm $(ROOT)\release\$VERSION\keymanengine-$VERSION.msm

prepareredist:
  rem

clean:
  rem

heat-cef:
    # We copy the files to a temp folder in order to exclude .git and README.md from harvesting
    -rmdir /s/q $(KEYMAN_WIX_TEMP_CEF)
    mkdir $(KEYMAN_WIX_TEMP_CEF)
    xcopy $(KEYMAN_CEF4DELPHI_ROOT)\* $(KEYMAN_WIX_TEMP_CEF)\ /s
    $(WIXHEAT) dir $(KEYMAN_WIX_TEMP_CEF) -o cef.wxs -ag -cg CEF -dr INSTALLDIR -var var.CefSourceDir -wx -nologo
    # When we candle/light build, we can grab the source files from the proper root so go ahead and delete the temp folder again
    -rmdir /s/q $(KEYMAN_WIX_TEMP_CEF)

candle: heat-cef
  $(WIXCANDLE) -dVERSION=$VERSION -dRELEASE=$RELEASE -ext WixUtilExtension keymanengine.wxs components.wxs
  $(WIXCANDLE) -dVERSION=$VERSION -dRELEASE=$RELEASE -dCefSourceDir=$(KEYMAN_CEF4DELPHI_ROOT) cef.wxs
