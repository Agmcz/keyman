#!/bin/sh

set -e

case "$1" in

  configure)
    # Restart IBus if it is running
    ! ibuspid=`ps -C ibus-daemon -o pid=`

    if [ "x$ibuspid" != "x" ]; then
      # check for gnome-shell as it works differently
      ! gspid=`ps -C gnome-shell -o pid=`
      if [ "x$gspid" == "x" ]; then
        ibususer=`ps -C ibus-daemon -o user=`
        sudo -H -u "$ibususer" ibus restart
      else
        # gnome-shell has multiple ibus-daemon processes and needs exit instead of restart
        ibususer=`ps -C ibus-daemon -o user=|grep -v gdm|uniq`
        sudo -H -u "$ibususer" ibus exit
      fi
    fi
  ;;

  abort-upgrade|abort-remove|abort-deconfigure)
    exit 0
  ;;

  *)
    echo "postinst called with unknown argument \`$1'" >&2
    exit 1
  ;;

esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
